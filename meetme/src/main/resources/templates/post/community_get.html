<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorator="~{layout/layout}">

<!-- ì»¨í…ì¸ í˜ì´ì§€ì˜ CSS ì˜ì—­ì´ ë“¤ì–´ê° -->
<th:block layout:fragment="css">
   <style>
      #profileImg {
         width: 2rem;
         height: 2rem;
      }

      li {
         list-style: none;
         padding-left: 0px;
      }
   </style>
</th:block>

<th:block layout:fragment="content">
   <!-- ì—¬ê¸°ì— bodyì— ë“¤ì–´ê°ˆ ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš” -->
   <div class="container bg-white">
      <section class="position-relative bg-tint-primary overflow-hidden p-5">
         <div class="col-lg-8 col-xl-7 mx-auto text-center">
            <h2 class=" display-6 aos-init" data-aos="fade-down" data-aos-duration="100"
               th:text="${list.postTitle}" id="postTitle"></h2>
         </div>

         <!-- <div id="userCheck" class="row mt-3 d-flex justify-content-end"> -->
         <div id="userCheck" class="row">
            <div class="col-lg-9"></div>
            <div class="col-lg-1 d-flex">
               <form action="/post/updateCommunity" method="get">
                  <input type="hidden" name="postId" id="postId" th:value="${list.postId}">
                  <button id="btnUpdate" class="btn btn-primary btn-sm mr-1">ìˆ˜ì •í•˜ê¸°</button>
               </form>
            </div>
            <div class="col-lg-1 d-flex">
               <div width="5px"></div>
               <!--ì‚­ì œì‹œ ëª¨ë‹¬-->
               <button id="btnDelete" class="btn btn-danger btn-sm ml-1" data-toggle="modal" data-target="#deleteModal">
                  ì‚­ì œí•˜ê¸°
               </button>
            </div>
            <div class="col-lg-1"></div>
         </div>
         <hr>
         <div class="d-flex mb-4 small align-items-center">
            <img th:src="@{|/img/user/${list.imgUrl}|}" alt="ì‚¬ì§„" class="size-40 rounded-circle me-2">
            <span class="text-muted d-inline-block">
                 By <a href="#!" class="text-dark" th:text="${list.nickname} "></a>
               <span class="mx-2">|</span>
               Hit <a href="#!" class="text-dark" th:text="${list.hit}"></a>íšŒ
            </span>
         </div>
         <section class="overflow-hidden">
            <div class="form-group container bg-white order-lg-last pb-7 pb-lg-5 position-relative ">
               <div class="justify-content-between align-items-center aos-init aos-animate" data-aos="fade-up"
                  data-aos-delay="100">
                  <!--ì½”ìŠ¤ ì—¬ê¸°-->
                  <th:block th:if='${course} != null'>
                     <section class="position-relative overflow-hidden bg-gradient-light">
                        <div class="container bg-white py-7 py-lg-5 position-relative z-index-1">
                           <div class="row align-items-center justify-content-between">
                              <div class="order-last order-lg-1 col-lg-7">
                                 <h2 class="mb-3 display-5 aos-init aos-animate fs-3" data-aos="fade-up">ì½”ìŠ¤ ì¶”ì²œ
                                 </h2>
                                 <br>
                                 <div style="margin-left: 20px; ">
                                    <span class="icon-Air-Balloon fs-6" th:utext="| ì½”ìŠ¤ ì´ë¦„ : ${course[0].courseName}|"></span><br>
                                    <span class="icon-Compass-4 fs-6" th:utext=" | ì§€ì—­ : ${course[0].region}|"></span>
                                 </div>
                                 <br>
                                 <!--Accordions-->
                                 <div class="accordion accordion-custom mb-5 aos-init aos-animate"
                                    id="accordionCustomExample" data-aos="fade-right" data-aos-delay="150">
                                    <th:block th:each="c : ${course}">
                                       <div class="accordion-item">
                                          <h2 class="accordion-header" id="headingCustomOne">
                                             <button class="accordion-button collapsed" th:text="${c.placeName}"
                                                type="button" data-bs-toggle="collapse" th:data-bs-target="|#${#strings.replace(c.placeName,' ','')}|"
                                                aria-expanded="false" aria-controls="collapseCustomOne">
                                             </button>
                                          </h2>
                                          <div th:id="${#strings.replace(c.placeName,' ','')}" class="accordion-collapse collapse"
                                            aria-labelledby="headingCustomOne" data-bs-parent="#accordionCustomExample"
                                            style="margin-left: 5px;">
                                             <div class="row d-flex accordion-body" style="padding: 25px;">
                                                <div class="col-lg-8">
                                                   <strong class="text-success fs-6" th:text="|[ ${c.courseComment} ]|"></strong>
                                                   <p th:text="|í‰ê·  ë¹„ìš© : ${c.avgCost}|"></p>
                                                   <p th:text="|ì£¼ì†Œ : ${c.address}|"></p>
                                                   <p th:if="${not #strings.isEmpty(c.description)}" th:text="|ì„¤ëª… : ${c.description}|"></p>
                                                
                                                </div>
                                                <div class="col-lg-4">
                                                  <img class="img-thumbnail rounded " th:src="${c.thumbnailHref}" alt="">
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </th:block>
                                 </div>
                              </div>
                              <div class="col-lg-5 ms-auto order-1 order-lg-last mb-5 mb-lg-0">
                                 <div class="position-relative aos-init aos-animate" data-aos="fade-left" data-aos-delay="150">
                                    <div id="map" style="width:100%;height:400px;"></div>
                                 </div>
                              </div>
                           </div>
                        </div>
                    </section>
                  </th:block>
                  <hr>
                  <!-- ê¸€ ë‚´ìš© here-->
                  <th:block th:utext="${list.postContent}" class="mx-auto text-center"></th:block>
                  <!-- <textarea name="postContent" class="form-control" id="ckcontents" th:text="${list.postContent}" disabled></textarea> -->
               </div>
            </div>
         </section> 
         <hr>
         <!--ëŒ“ê¸€ í…œí”Œë¦¿-->
         <!--ëŒ“ê¸€ ìˆ˜ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ë§Œë“¤ì–´ì„œ ë„£ì–´ì£¼ê¸°-->
         <h4 class="mb-5" id="commentCount" ></h4>
         <ul class="list-unstyled mb-5 mb-lg-10" id="commentsBody">
            <li th:each="list : ${cmt}" class="d-flex mb-3 justify-content-between commentWrap">
               <div class="row d-flex col-lg-12">
                  <div class="me-1 col-lg-1 d-flex">
                      <img th:src="@{|/img/user/${list.imgUrl}|}" alt="ì´ë¯¸ì§€" id="profileImg" class="size-50 rounded-circle">
                  </div>
                  <div class="px-3 py-4 border rounded border-end col-lg-10">
                        <div class="d-flex mb-3 justify-content-between">
                           <div class="d-flex align-items-center">
                                 <h6 class="mb-0 me-3 fs-5" th:text="${list.nickname}"></h6>
                                 <small class="text-muted" th:text="${#dates.format(list.comCreated,'yyyy.MM.dd.')}"></small>
                           </div>
                           <div th:if="${session.userSession.userId} == ${list.userId}">
                              <div>
                                 <!-- <input type="hidden" th:name="commentId" th:value="${list.commentId}"> -->
                                 <button type="button" class="cmtUpdBtn btn btn-primary btn-sm"
                                    th:data-content="${list.comContent}" th:data-commnetId="${list.commentId}"
                                    data-toggle="modal" data-target="#comUpdateModal">
                                    <i class="far fa-edit"></i>ìˆ˜ì •í•˜ê¸°
                                 </button>
                                 <!--ì‚­ì œì‹œ alert-->
                                 <button type="button" class="cmtDelBtn btn btn-danger btn-sm" th:data-cId="${list.commentId}">
                                    <i class="far fa-trash-alt"></i>ì‚­ì œí•˜ê¸°
                                 </button>
                              </div>
                           </div>
                        </div>
                        <p class="mb-0" th:id="${list.commentId}" th:text="${list.comContent}"></p>
                  </div>
               </div>
            </li>
         </ul>
   

         <!-- ëŒ“ê¸€ ì…ë ¥ -->
         <h4 class="mb-4">Post a comment</h4>
            <form>
               <div class="mb-3">
                  <!--${session.userSession.imgUrl}ë¡œ ë§Œë“¤ì–´ì£¼ì…”ì—¬-->
                  <img class="rounded-circle"  th:src="@{|/img/user/${session.userSession.imgUrl}|}" style="width: 2.5rem; height:2.5rem;">
                  <span class="pl-3" style="font-size: 1.6rem;" th:text="${session.userSession.nickname}"></span>
               </div>
               <div class="mb-3">
                   <textarea class="form-control" id="cmtContent" th:name="comContent" rows="10" placeholder="Comment"></textarea>
               </div>
               <div class="d-flex align-items-right justify-content-between">
                  <button type="button" class="cmtInsBtn btn btn-danger btn-hover-arrow btn-sm mb-1" style="float:right;">
                     ëŒ“ê¸€ ë“±ë¡
                  </button>
               </div>
            </form>

         <hr>
         <!--ë¡œê·¸ì¸ í•œ ì‚¬ëŒ, ê¸€ ì£¼ì¸ ì•„ë‹Œ ì‚¬ëŒë§Œ ì¢‹ì•„ìš” ë²„íŠ¼ ë„£ê¸°~ -->
         <li th:if="${session.userSession.userId} !=null">
            <div th:if="${session.userSession.userId} != ${list.userId}">
            <div class="row mt-3 d-flex justify-content-center">
               <div class="col-auto">
                  <button type="submit" name="submit" id="likeBtn" class="likeBtn rounded-pill btn btn-rise btn-outline-danger m-2"
                     th:classappend="${like} == 1 ? d-none" data-toggle="modal" data-target="#likeModal">
                     <div class="btn-rise-bg bg-danger"></div>
                     <div class="btn-rise-text">ì¢‹ì•„ìš”ğŸ’–</div>
                  </button>
               </div>
               <div class="col-auto">
                  <button type="submit" name="submit" id="likeCancelBtn" class="likeCancelBtn btn btn-primary"
                     th:classappend="${like} == 0 ? d-none" data-toggle="modal" data-target="#likeCancelModal">ì¢‹ì•„ìš”
                     ì·¨ì†Œ</button>
               </div>
               <!-- ë¡œê·¸ì¸ë˜ì–´ ìˆìœ¼ë©´ì„œ ì½”ìŠ¤ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ ì½”ìŠ¤ ìŠ¤í¬ë©í•˜ê¸° ë²„íŠ¼ ë‚˜ì˜¤ê²Œ!-->
               <!-- th:clasappend ì´ìš©!-->
               <th:block th:if="${course} != null">
                  <div class="col-auto">
                     <button type="submit" name="submit" id="scrapBtn" class="scrapBtn rounded-pill btn btn-rise btn-outline-danger m-2"
                        th:classappend="${scrap} == 1 ? d-none" data-toggle="modal" data-target="#scrapModal">
                        <div class="btn-rise-bg bg-danger"></div>
                        <div class="btn-rise-text">ì½”ìŠ¤ ìŠ¤í¬ë©âœ” </div>
                     </button>
                  </div>
                  <div class="col-auto">
                     <button type="submit" name="submit" id="scrapCancelBtn" class="scrapCancelBtn btn btn-primary"
                        th:classappend="${scrap} == 0 ? d-none" data-toggle="modal" data-target="#scrapCancelModal">ì½”ìŠ¤ ìŠ¤í¬ë©
                        ì·¨ì†Œ</button>
                  </div>
               </th:block>
               <br>
               <div align="right">
                  <a th:href="@{/post/community_list}" class="btn btn-primary btn-circle-ripple p-0 size-50 rounded-pill fs-3 lh-1 center-both me-4 mb-3"
                  data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="ëª©ë¡ìœ¼ë¡œ">
                              <div class="btn-rise-bg bg-primary"></div>
                              <div class="btn-rise-text"><i class="fs-3 bi bi-list-ul"></i></div>
                 </a>
               </div>   
            </div>
         </div>   
         </li>
      </section>
   </div>

   <!-- ì½”ìŠ¤ ìŠ¤í¬ë©í•˜ê¸° ëª¨ë‹¬ -->
   <div class="modal fade " id="scrapModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content">
            <div class="modal-header">
               <h4 class="modal-title" id="myModalLabel">ìŠ¤í¬ë© ì„±ê³µ!</h4>
               <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close">
                  <i class="bi bi-x"></i>
               </button>
            </div>
            <div class="modal-body"  align="center">
               <br>
               <h5>ìŠ¤í¬ë© ì„±ê³µ!!</h5>
               <h6>ë§ˆì´í˜ì´ì§€ ë‚˜ì˜ ì½”ìŠ¤ì—ì„œ í™•ì¸ í•  ìˆ˜ ìˆì–´ìš”â£</h6>
               <br>
            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-primary likeChk" data-dismiss="modal">í™•ì¸</button>

            </div>
         </div>
      </div>
   </div>

   <!-- ì½”ìŠ¤ ìŠ¤í¬ë© ì·¨ì†Œí•˜ê¸° ëª¨ë‹¬ -->
   <div class="modal fade " id="scrapCancelModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content">
            <div class="modal-header">
               <h4 class="modal-title" id="myModalLabel">ìŠ¤í¬ë© ì·¨ì†Œ</h4>
               <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close">
                  <i class="bi bi-x"></i>
               </button>
            </div>
            <div class="modal-body"  align="center">
               <br>
               <h6>ìŠ¤í¬ë© ì·¨ì†Œ ì„±ê³µ!!</h6>
               <h6>ìŠ¤í¬ë© ì·¨ì†Œì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤. ğŸ’¦</h6>
               <br>
            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-primary likeChk" data-dismiss="modal">í™•ì¸</button>

            </div>
         </div>
      </div>
   </div>

   <!-- ì¢‹ì•„ìš” ëª¨ë‹¬ -->
   <div class="modal fade " id="likeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content">
            <div class="modal-header">
               <h4 class="modal-title" id="myModalLabel">ì¢‹ì•„ìš” ì„±ê³µ!</h4>
               <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close">
                  <i class="bi bi-x"></i>
               </button>


            </div>
            <div class="modal-body" align="center">
               <br>
               <h5 >ì¢‹ì•„ìš” ëˆŒë €ì–´ìš”! ğŸ’–</h5>
               <h6>ë§ˆì´í˜ì´ì§€ ë‚˜ì˜ ìŠ¤í¬ë©ì—ì„œ í™•ì¸ í•  ìˆ˜ ìˆì–´ìš”</h6>
               <br>
            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-primary likeChk" data-dismiss="modal">í™•ì¸</button>
            </div>
         </div>
      </div>
   </div>

   <!-- ì¢‹ì•„ìš” ì·¨ì†Œ ëª¨ë‹¬ -->
   <div class="modal fade " id="likeCancelModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content">
            <div class="modal-header">
               <h4 class="modal-title" id="myModalLabel">ì¢‹ì•„ìš” ì·¨ì†Œ ì„±ê³µ!</h4>
               <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close">
                  <i class="bi bi-x"></i>
               </button>


            </div>
            <div class="modal-body"  align="center">
               <br>
               <h5>ì¢‹ì•„ìš” ì·¨ì†Œ ë˜ì—ˆì–´ìš”</h5>
               <h6>ğŸ˜¥</h6>
            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-primary likeChk" data-dismiss="modal">í™•ì¸</button>
            </div>
         </div>
      </div>
   </div>

   <!-- ê¸€ ì‚­ì œ í™•ì¸ Modal -->
   <div class="modal fade " id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content">
            <div class="modal-header">
               <h4 class="modal-title" id="myModalLabel">ê²Œì‹œê¸€ ì‚­ì œí•˜ê¸°</h4>
               <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close">
                  <i class="bi bi-x"></i>
               </button>
            </div>
            <div class="modal-body" align="center">
               <br>
               <h5>ì •ë§ ì‚­ì œ í•˜ì‹œê² ìŠµë‹ˆê¹Œâ“  </h5>
               <br>
            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-default likeChk" data-dismiss="modal">ì·¨ì†Œ</button>
            
                 
                  <button type="submit" class="btn btn-primary postDeleteBtn">ì‚­ì œí•˜ê¸°</button>
             
            </div>
         </div>
      </div>
   </div>

   <!--ëŒ“ê¸€ ìˆ˜ì • í™•ì¸ ëª¨ë‹¬-->
   <div class="modal fade " id="comUpdateModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content">
            <div class="modal-header">
               <h4 class="modal-title" id="myModalLabel">ëŒ“ê¸€ ìˆ˜ì •í•˜ê¸°</h4>
               <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close">
                  <i class="bi bi-x"></i>
               </button>
            </div>

            <div class="modal-body">
               <input type="hidden" id="modalCmtId">
               <textarea class="form-control" id="modalCmtContent" rows="3" th:name="modalCmtContent"
                  th:value="${modalCmtContent}"></textarea>
            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-default likeChk" data-dismiss="modal">ì·¨ì†Œ</button>
               <button type="submit" class="btn btn-primary" id="comUpdateBtn">ìˆ˜ì •í•˜ê¸°</button>
            </div>

         </div>
      </div>
   </div>

</th:block>
<th:block layout:fragment="script">
   <!-- ë„¤ì´ë²„ ì§€ë„ -->
   <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=v1v61xter8">
   </script>
   <!-- js here -->
   <script type="text/javascript" th:inline="javascript">
      /*<![CDATA[*/
      const course = /*[[${course}]]*/ '';
      const commentCnt = /*[[${count}]]*/'';
      /*]]>*/
      
      // ============ í˜ì´ì§€ ë¡œë“œ ==============
      $(function () {


         if (course != null) {
            let courseId = course[0].courseId;
            console.log('ì½”ìŠ¤ì•„ì´ë””' + courseId);
         }

         //ëŒ“ê¸€ ê°¯ìˆ˜ ë¿Œë¦¬ê¸°
         $('#commentCount').text("Comments("+commentCnt+")")

         //ê¸€ ì‚­ì œ ëª¨ë‹¬ ë„ìš°ê¸°!
         $('#btnDelete').on('click', function () {
            $('#deleteModal').modal('show');
            console.log("ì‚­ì œëª¨ë‹¬ë‚˜ì™€ë¼")
         })

         //ê¸€ ì‚­ì œí•˜ê¸°!
         const postDelete = $('.postDeleteBtn');
         postDelete.on("click", function(){
            postId = $('#postId').val();
            postDeletConfirm(postId);
            $('#deleteModal').modal('hide');
         });

         function postDeletConfirm(postId){
            console.log(postId);
            $.ajax({
               url: "/post/postDelete",
               method: "post",
               data: {postId : postId},
               success: function (result) {
                  console.log(result);
                  location.href ="/post/community_list"
               },
               error: function (err) {
                  console.log(err);
               }
            });
         }

         let locations = [];
         let centerLat = 0;
         let centerLng = 0;

         let highGap = 0;
		   let zoomNum = 0;
         
         //ì½”ìŠ¤ ìˆìœ¼ë©´ ë„¤ì´ë²„ì§€ë„ì—ì„œ í•´ì£¼ê¸°!
         if (course != null) {
            for (let item of course) {
               let info = {
                  place: item.placeName,
                  add : item.address,
                  lat: item.latitude,
                  lng: item.longtitude
               }
               locations.push(info);
               centerLat += parseFloat(item.latitude);
               centerLng += parseFloat(item.longtitude);
            }
            console.log(centerLat, centerLng);
            centerLat = centerLat / course.length;
            centerLng = centerLng / course.length;
            console.log(locations);
            console.log(centerLat, centerLng);
			
         	// ì¤Œ ê³„ì‚°
			
            if(course.length == 1) {
               zoomNum = 12;
            } else if (course.length == 2){
               let courseOne = {
                  lat: parseFloat(course[0].latitude),
                  lng: parseFloat(course[0].longtitude)
               };
               let courseTwo = {
                  lat: parseFloat(course[1].latitude),
                  lng: parseFloat(course[1].longtitude)
               };
               let resultCourse = {
                  lat: courseOne.lat - courseTwo.lat,
                  lng: courseOne.lng - courseTwo.lng
               }
               
               if(resultCourse.lat < 0) {
                  resultCourse.lat = -(resultCourse.lat)
               }
               if(resultCourse.lng < 0) {
                  resultCourse.lng = -(resultCourse.lng)
               }
               
               let result = Math.sqrt(
                  Math.pow(resultCourse.lng, 2) + 
                  Math.pow(resultCourse.lat, 2)
               )
               highGap = result;
               zoomNum = 12 - Math.round(highGap);
            } else {
               
               for(let i=0; i<course.length; i++) {
                  for(let j=0; j<i; j++) {
                     let courseOne = {
                        lat: parseFloat(course[i].latitude),
                        lng: parseFloat(course[i].longtitude)
                     };
                     let courseTwo = {
                        lat: parseFloat(course[j].latitude),
                        lng: parseFloat(course[j].longtitude)
                     };
                     let resultCourse = {
                        lat: courseOne.lat - courseTwo.lat,
                        lng: courseOne.lng - courseTwo.lng
                     }
                     
                     if(resultCourse.lat < 0) {
                        resultCourse.lat = -(resultCourse.lat)
                     }
                     if(resultCourse.lng < 0) {
                        resultCourse.lng = -(resultCourse.lng)
                     }
                     
                     let result = Math.sqrt(
                        Math.pow(resultCourse.lng, 2) + 
                        Math.pow(resultCourse.lat, 2)
                     )
                     
                     if(highGap < result) {
                        highGap = result;
                        zoomNum = 12 - Math.ceil(highGap);
                     }
                  }
               }
            }
            //map ìƒì„±
            var map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(centerLat, centerLng),
            zoom: zoomNum
         });

         }
            
       
         var markerOptions = {
            map: map,
            icon: {
               url: "https://img.icons8.com/plasticine/100/000000/marker.png",
               size: new naver.maps.Size(50, 52),
               origin: new naver.maps.Point(0, 0),
               anchor: new naver.maps.Point(25, 26)
            }
         };

         let markerCourseArr = [];
         let markerCourseObj = {};
         let accordionButton = $('.accordion-button');

         for (var i = 0; i < locations.length; i++) {
            var marker = new naver.maps.Marker({
               map: map,
               title: locations[i].place,
               position: new naver.maps.LatLng(locations[i].lat, locations[i].lng),
               icon: {
                  url: "https://img.icons8.com/officel/32/000000/place-marker--v2.png",
                  size: new naver.maps.Size(50, 52),
                  origin: new naver.maps.Point(0, 0),
                  anchor: new naver.maps.Point(25, 26)
               }
            });

            var infoWindow = new naver.maps.InfoWindow({
               content: '<div class="mapboxgl-popup mapboxgl-popup-anchor-bottom" style="max-width: 240px; "><div class="mapboxgl-popup-tip"></div><div class="mapboxgl-popup-content">'
                  + '<small class="text-secondary"> ['+ (i+1)+' ë²ˆì§¸ ì¥ì†Œ]'
                  +'<br><h5 class="text-primary mb-0 fw-normal"><b>' 
                  + locations[i].place + 
                  '</b></h5><small class="text-muted">'+ locations[i].add 
                  +'</small></div></div>'
            });

            markerCourseObj = {
               marker: marker,
               info: infoWindow,
               loc: accordionButton[i]
            }

            markerCourseArr.push(markerCourseObj);

            $('#popUpBtn').on("click",popUpClose);
         }
			
         function popUpClose(){
            $(".mapboxgl-popup").close();
         }

         for(let l of markerCourseArr){
            $(l.loc).on('click', ()=>{
               if (l.info.getMap()) {
                  l.info.close();
               } else {
                  l.info.open(map, l.marker); //í‘œì¶œ
               }
            });

            naver.maps.Event.addListener(l.marker, 'click', ()=>{
               $(l.loc).click();
            });
         }

         $(accordionButton).eq(0).click();

         // ======= ëŒ“ê¸€ ì²˜ë¦¬ =========
         let cmtId = null; // ëŒ“ê¸€ sequenceId
         let postId = null; // ê²Œì‹œê¸€ sequenceId
         let userId = userSession == null ? "" : userSession.userId;
         /*<![CDATA[*/
         let postUserId = /*[[${list.userId}]]*/'';
         /*]]*/
         console.log(postUserId);
         let comContent = null; // ëŒ“ê¸€ ë‚´ìš©

         const cmtDelBtn = $('.cmtDelBtn'); //ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼(ì—¬ëŸ¬ ê°œê°€ ì„ íƒ)
         const cmtUpdBtn = $('.cmtUpdBtn'); // ëŒ“ê¸€ ìˆ˜ì • ë²„íŠ¼(ì—¬ëŸ¬ ê°œê°€ ì„ íƒ)
         const comUpdateBtn = $('#comUpdateBtn'); //ëª¨ë‹¬ì•ˆì— ìˆ˜ì •ë²„íŠ¼
         const cmtInsBtn = $('.cmtInsBtn'); // ëŒ“ê¸€ ì…ë ¥ ë²„íŠ¼

         const likeBtn = $('#likeBtn'); //ì¢‹ì•„ìš” ë²„íŠ¼
         const scrapBtn = $('#scrapBtn'); //ìŠ¤í¬ë© ë²„íŠ¼
         const likeCancelBtn = $('#likeCancelBtn'); //ì¢‹ì•„ìš” ì·¨ì†Œ ë²„íŠ¼
         const scrapCancelBtn = $('#scrapCancelBtn'); //ìŠ¤í¬ë© ì·¨ì†Œ ë²„íŠ¼

         const userCheck = $('#userCheck'); // ì‘ì„±ìì™€ ë¡œê·¸ì¸ ìœ ì €ê°€ ê°™ì„

         // userId != postUserId => $('#userCheck').hide()
         console.log(userCheck);
         if (userId != postUserId || userId == "") {
            $(userCheck).removeClass('d-flex');
            $(userCheck).addClass('d-none');
         }

         const modalCmtContent = $('#modalCmtContent');
         const modalCmtId = $('#modalCmtId');
         console.log(cmtInsBtn);


         //ì¢‹ì•„ìš” ëª¨ë‹¬ ë‹«ê¸°
         const closeBtn = $('.btn-close');
         const closeChk = $('.likeChk');

         closeBtn.on("click", function () {
            $('#likeModal').modal("hide");
            $('#likeCancelModal').modal('hide');
            $('#scrapModal').modal('hide');
            $('#scrapCancelModal').modal('hide');
            $('#comUpdateModal').modal('hide');
            $('#deleteModal').modal('hide');
         });

         closeChk.on("click", function () {
            $('#likeModal').modal("hide");
            $('#likeCancelModal').modal('hide');
            $('#scrapModal').modal('hide');
            $('#scrapCancelModal').modal('hide');
            $('#comUpdateModal').modal('hide');
            $('#deleteModal').modal('hide');
         });

         //ìŠ¤í¬ë© ëª¨ë‹¬ ë‹«ê¸° 
         const scrapClose = $('.cCloseBtn');
         const scrapChk = $('.scrapChk');
         scrapClose.on("click", function () {
            $('#scrapModal').modal("hide");
         })
         scrapChk.on("click", function () {
            $('#scrapModal').modal("hide");
         })

         // ëŒ“ê¸€ ì‚­ì œ
         for (let d of cmtDelBtn) {
            $(d).on('click', function () {
               cmtId = $(d).attr('data-cId');
               confirmDel(cmtId);
            })
         }
         // ëŒ“ê¸€ ìˆ˜ì •
         for (let d of cmtUpdBtn) {
            $(d).on('click', function () {
               comContent = $(d).attr('data-content');
               cmtId = $(d).attr('data-commnetId');
               console.log(comContent);
               $(modalCmtContent).val(comContent);
               $(modalCmtId).val(cmtId);
               $('#comUpdateModal').modal('show');
            })
         }

         //ëª¨ë‹¬ ì•ˆì˜ ìˆ˜ì •ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
         $(comUpdateBtn).on('click', function () {
            confirmUpdate($(modalCmtId).val(), $(modalCmtContent).val());
         })

         // ëŒ“ê¸€ ì…ë ¥
         $(cmtInsBtn).on('click', function () {
            postId = $('#postId').val();
            comContent = $('#cmtContent').val();
            data = {
               postId: postId,
               userId: userId,
               comContent: comContent,
               postUserId : postUserId
            }
            console.log(data);
            confirmIns(data);
         })

         //ì¢‹ì•„ìš”
         $(likeBtn).on('click', function () {
            postId = $('#postId').val();
            data = {
               postId: postId,
               userId: userId
            }
            console.log(data);
            likePost(data);
            //ì¢‹ì•„ìš” í–ˆì–´ìš” ëª¨ë‹¬ë¡œ!
            $('#likeModal').modal('show');
            //ì¢‹ì•„ìš” ì·¨ì†Œí•˜ê¸° ë²„íŠ¼ìœ¼ë¡œ ë°”ê¾¸ê¸°
            //ì¢‹ì•„ìš” ì·¨ì†Œí•˜ê¸° ë²„íŠ¼ d-noneí´ë˜ìŠ¤ë¥¼ remove
            $('#likeCancelBtn').removeClass("d-none");
            //ì¢‹ì•„ìš” ë²„íŠ¼ d-noneí´ë˜ìŠ¤ë¥¼ add
            $('#likeBtn').addClass("d-none");
         })

         //ìŠ¤í¬ë©í•˜ê¸° ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ
         $(scrapBtn).on('click', function () {
            let courseId = course[0].courseId;
            console.log("ìŠ¤í¬ë© ì½”ìŠ¤ ì•„ì´ë””" + courseId)
            data = {
               courseId: courseId,
               userId: userId
            }
            console.log(data);
            scrapCourse(data);


            $('#scrapModal').modal('show');
            //ì¢‹ì•„ìš” ì·¨ì†Œí•˜ê¸° ë²„íŠ¼ìœ¼ë¡œ ë°”ê¾¸ê¸°
            //ì¢‹ì•„ìš” ì·¨ì†Œí•˜ê¸° ë²„íŠ¼ d-noneí´ë˜ìŠ¤ë¥¼ remove
            $('#scrapCancelBtn').removeClass("d-none");
            //ì¢‹ì•„ìš” ë²„íŠ¼ d-noneí´ë˜ìŠ¤ë¥¼ add
            $('#scrapBtn').addClass("d-none");
         })

         //ì¢‹ì•„ìš” ì·¨ì†Œí•˜ê¸° 
         $(likeCancelBtn).on('click', function () {
            postId = $('#postId').val();
            data = {
               postId: postId,
               userId: userId
            }
            likeCancelPost(data);
            //ì¢‹ì•„ìš” í–ˆì–´ìš” ëª¨ë‹¬ë¡œ!
            $('#likeCancelModal').modal('show');
            //ì¢‹ì•„ìš” ì·¨ì†Œí•˜ê¸° ë²„íŠ¼ìœ¼ë¡œ ë°”ê¾¸ê¸°
            //ì¢‹ì•„ìš” ì·¨ì†Œí•˜ê¸° ë²„íŠ¼ d-noneí´ë˜ìŠ¤ë¥¼ remove
            $('#likeBtn').removeClass("d-none");
            //ì¢‹ì•„ìš” ë²„íŠ¼ d-noneí´ë˜ìŠ¤ë¥¼ add
            $('#likeCancelBtn').addClass("d-none");
         })
         //ìŠ¤í¬ë© ì·¨ì†Œí•˜ê¸°
         $(scrapCancelBtn).on('click', function () {
            let courseId = course[0].courseId;
            data = {
               courseId: courseId,
               userId: userId
            }
            scrapCancel(data);
            // ëª¨ë‹¬ ë„ìš°ê¸°!
            $('#scrapCancelModal').modal('show');
            //ìŠ¤í¬ë©í•˜ê¸° ë²„íŠ¼ d-noneí´ë˜ìŠ¤ë¥¼ remove
            $('#scrapBtn').removeClass("d-none");
            //ìŠ¤í¬ë© ì·¨ì†Œ ë²„íŠ¼ d-noneí´ë˜ìŠ¤ë¥¼ add
            $('#scrapCancelBtn').addClass("d-none");
         })
      });

      //ìŠ¤í¬ë©í•˜ê¸° ì·¨ì†Œí•˜ê¸° 
      function scrapCancel(courseId, userId) {
         $.ajax({
            url: "/post/scrapCourseCancel",
            method: "delete",
            data: JSON.stringify(data),
            dataType: 'json',
            contentType: 'application/json;charset="utf-8"',
            success: function (result) {
               console.log(result);
            },
            error: function (err) {
               console.log(err);
            }
         })
      }

      //ì¢‹ì•„ìš” ì·¨ì†Œí•˜ê¸°
      function likeCancelPost(postId, userId) {
         $.ajax({
            url: "/post/postLikeCancel",
            method: "delete",
            data: JSON.stringify(data),
            dataType: 'json',
            contentType: 'application/json;charset="utf-8"',
            success: function (result) {
               console.log(result);
            },
            error: function (err) {
               console.log(err);
            }
         })
      }

      //ìŠ¤í¬ë©í•˜ê¸°
      function scrapCourse(courseId, userId) {
         $.ajax({
            url: "/post/scrapCourse",
            method: "post",
            data: JSON.stringify(data),
            dataType: 'json',
            contentType: 'application/json;charset="utf-8"',
            success: function (result) {
               console.log(result);
            },
            error: function (err) {
               console.log(err);
            }
         })
      }

      //ì¢‹ì•„ìš” í•˜ê¸°
      function likePost(postId, userId) {
         $.ajax({
            url: "/post/postLike",
            method: "post",
            data: JSON.stringify(data),
            dataType: 'json',
            contentType: 'application/json;charset="utf-8"',
            success: function (result) {
               console.log(result);
            },
            error: function (err) {
               console.log(err);
            }
         })

      }
      //ëª¨ë‹¬ì˜ ìˆ˜ì • ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ
      function confirmUpdate(cmtId, comContent) {
         $.ajax({
            url: '/post/commentUpdate',
            type: 'put',
            data: JSON.stringify({
               commentId: cmtId,
               comContent: comContent
            }),
            dataType: "json",
            contentType: "application/json;charset='utf-8'",
            success: function (data) {
               closeModal(data);
            },
            error: function (error) {
               console.log(error);
            }
         });
      }

      //ëª¨ë‹¬ ë‹«ê³  ì—…ë°ì´íŠ¸!
      function closeModal(data) {
         $(comUpdateModal).modal('hide');
         $(".commentWrap").find("#" + data.commentId).html(data.comContent)
      }

      // ëŒ“ê¸€ ì‚­ì œ
      function confirmDel(cmtId) {
         const comment = $('[data-cId="' + cmtId + '"]').closest(".commentWrap");
         if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            $.ajax({
               url: '/post/delCMComment/' + cmtId,
               type: 'delete',
               success: function () {
                  $(comment).remove();
                  alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!!');
               }
            });
         }
      }

      // ëŒ“ê¸€ ì…ë ¥
      function confirmIns(data) {
    	  let postTitle=$('#postTitle').text(); //ëŒ“ê¸€ ì•Œë¦¼ì— ê²Œì‹œê¸€ ì œëª©ì„ ë„£ê¸°ìœ„í•œ ì‘ì—…ì…ë‹ˆë‹¹.
    	  data.postTitle=postTitle;
    	  $.ajax({
            url: "/post/insertCMComment",
            method: "post",
            data: JSON.stringify(data),
            dataType: 'json',
            contentType: 'application/json;charset="utf-8"',
            success: function (result) {
               console.log(result);
               insertCallback(result);
               //ë‚´ìš©ì…ë ¥í›„ textarea ì§€ì›Œì£¼ê¸°~
               document.getElementById("cmtContent").value='';
            },
            error: function (err) {
               console.log(err);
            }
         })
      }

      function insertCallback(result) {
         let commentWrap = $("<div />")
            .addClass("row d-flex col-lg-12 mb-3  commentWrap");
         let Wrap = $("<div />")
         	.addClass("px-3 py-4 border rounded border-end col-lg-10");
         let imgDiv = $('<div />').addClass("me-1 col-lg-1");
         let btnName = $('<div />').addClass("d-flex mb-3 justify-content-between");
         let profileImg = $("<img />")
            .addClass("size-50 arounded-circle")
            .attr({
               src: "/img/user/"+result.imgUrl,
               alt: "ì´ë¯¸ì§€",
               id: "profileImg"
            });
        
         let nickname = $("<span />").addClass("pl-2").text(result.nickname);
         let comContent = $("<span />").addClass("pl-2").attr("id", result.commentId).text(result.comContent);
		 
         let btnWrap = $("<div />")
         let updBtn = $("<button />")
            .addClass("cmtUpdBtn1 m-1 btn btn-primary btn-sm")
            .attr("data-content", result.comContent)
            .attr("data-commentId", result.commentId)
            .attr("data-toggle", "modal")
            .attr("data-target", "#comUpdateModal")
            .click(function () {
               console.log("comContent" + result.comContent);
               console.log("commentId" + result.commentId);
               $(modalCmtContent).val(result.comContent);
               $(modalCmtId).val(result.commentId);
               $('#comUpdateModal').modal('show');
            });

         let upIcon = $("<i />").addClass("far fa-edit").text("ìˆ˜ì •í•˜ê¸°");

         $(updBtn).append(upIcon);

         let delBtn = $("<button />")
            .addClass("cmtDelBtn1 btn btn-danger btn-sm")
            .attr("data-cId", result.commentId)
            .click(function () {
               confirmDel(result.commentId);
            });



         let delIcon = $("<i />").addClass("far fa-trash-alt").text("ì‚­ì œí•˜ê¸°");
         $(delBtn).append(delIcon);

         $(btnWrap).append(updBtn, delBtn);
         $(imgDiv).append(profileImg );
         $(btnName).append(nickname,btnWrap)
         $(Wrap).append(btnName, comContent)
         $(commentWrap).append(imgDiv, Wrap);
         $("#commentsBody").append(commentWrap);

         //ëŒ“ê¸€ ìˆ˜ ë°”ê¾¸ê¸°
         $('#commentCount').text("Comments("+(commentCnt+1)+")")
      }

      //ë§ˆì»¤ì˜ ì§€ì—­ ë‹´ê¸°
      /*     function initMap(){
              var areaArr = new Array(); //ì§€ì—­ ë‹´ì„ ë°°ì—´
              areaArr.push(
                  for(let loc of '${course}'){
                      {location: "${loc.region}", lat : "${loc.latitude}", lng : "${loc.longtitude}"}
                  }
              );
          }
           */

          
   </script>




</th:block>

</html>